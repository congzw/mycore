using Microsoft.AspNetCore.Hosting;
using Microsoft.AspNetCore.Mvc;
using System;
using System.Collections.Generic;
using System.IO;
using System.Text;
using System.Text.RegularExpressions;
using System.Threading.Tasks;

namespace LixbApi
{
    [Route("Api/File")]
    [ApiController]
    public class FileController : ControllerBase
    {
        private readonly IHostingEnvironment _hostingEnvironment;

        public FileController(IHostingEnvironment hostingEnvironment)
        {
            _hostingEnvironment = hostingEnvironment;
        }
        [HttpPost("UploadBase64")]
        public async Task<MessageResult> UploadBase64(Base64File base64File)
        {
            var url = await GetFromBase64File(base64File);
            return MessageResult.CreateSuccess("成功",url);
        }

        [HttpGet("test")]
        public string Test()
        {
            return DateTime.Now.ToString();
        }

        [HttpGet("testFile")]
        public async Task<string> TestFile()
        {
            var base64File = new Base64File()
            {
                Id = "123",
                Type = "jpg",
                FileName = "test.jpg",
                Base64 = "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"
            };
            var url = await GetFromBase64File(base64File);
            return url;
        }

        public async Task<string> GetFromBase64File(Base64File base64File)
        {
            //适配前端和后端转64编码的不一致
            var fileData = base64File.Base64;
            var match = Regex.Match(base64File.Base64, string.Format("data:image/{0};base64,([\\w\\W]*)$", base64File.Type));
            if (match.Success)
            {
                fileData = match.Groups[1].Value;
            }
            var fileBytes = Convert.FromBase64String(fileData);
            var folderPath = "upload";
            return await SavePic(fileBytes, folderPath, base64File.FileName, null);

        }

        private async Task<string> SavePic(Byte[] bytes, string folderPath, string fileName, string typeDesc)
        {
            var rootPath = _hostingEnvironment.WebRootPath;
            var fileType = Path.GetExtension(fileName);
            var filePath = Path.Combine(rootPath, folderPath);
            if (!Directory.Exists(filePath))
            {
                Directory.CreateDirectory(filePath);
            }

            return await Task.Run(() =>
            {
                var path = Path.Combine(filePath, fileName);
                System.IO.File.WriteAllBytes(path, bytes);
                var fileUrl = Path.Combine(folderPath, fileName);
                return fileUrl;
            });
        }
    }
}
